<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<title>G6 Mind Map - Slot Game AI Pipeline</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  html,body{margin:0;padding:0;height:100%;font-family:'Inter',system-ui,'Microsoft JhengHei',sans-serif;background:#0f1216;color:#e6e9ed;}
  header{padding:12px 18px;background:#162029;border-bottom:1px solid #253341;display:flex;align-items:center;gap:1rem;}
  header h1{margin:0;font-size:1rem;font-weight:600;letter-spacing:.5px;background:linear-gradient(120deg,#4f8bff,#ff3fa4);-webkit-background-clip:text;color:transparent;}
  header a{color:#8fa4b5;text-decoration:none;font-size:.75rem;padding:.4rem .7rem;border:1px solid #2b3a46;border-radius:6px;background:#1d2731;}
  header a:hover{color:#fff;border-color:#4f8bff;}
  #toolbar{display:flex;flex-wrap:wrap;gap:.5rem;padding:10px 16px;background:#141c23;border-bottom:1px solid #253341;}
  #toolbar button{background:#1d2731;color:#c9d5df;border:1px solid #2f3d49;padding:.45rem .8rem;font-size:.65rem;border-radius:6px;cursor:pointer;letter-spacing:.5px;}
  #toolbar button:hover{border-color:#4f8bff;color:#fff;}
  #mount{width:100%;height:calc(100vh - 126px);}
  #status{font-size:.6rem;padding:6px 16px;color:#8595a4;background:#11181f;border-top:1px solid #253341;display:flex;gap:1rem;flex-wrap:wrap;}
  .badge{display:inline-block;padding:2px 6px;font-size:.55rem;border:1px solid rgba(255,255,255,.15);border-radius:10px;margin-left:.4rem;background:#1c2732;color:#9cb3c5;}
</style>
</head>
<body>
<header>
  <h1>G6 Mind Map</h1>
  <a href="index.html">è¿”å›é¦–é </a>
  <a href="AIè£½ç¨‹/concept-art-generator/frontend/pipeline_mindmap.html" target="_blank">åŸ PIXI ç‰ˆæœ¬</a>
</header>
<div id="toolbar">
  <button id="expandAll">å±•é–‹å…¨éƒ¨</button>
  <button id="collapseAll">æ”¶åˆå…¨éƒ¨</button>
  <button id="fitView">Fit View</button>
  <button id="resetLayout">é‡æ–°å¥—ç”¨ä½ˆå±€</button>
  <button id="exportPNG">åŒ¯å‡º PNG</button>
  <input id="search" placeholder="æœå°‹ç¯€é»..." style="background:#1d2731;color:#dbe5ec;border:1px solid #2f3d49;padding:.45rem .6rem;font-size:.65rem;border-radius:6px;min-width:220px;" />
</div>
<div id="mount"></div>
<div id="status">ç¯€é»: <span id="nodeCount">--</span> é‚Š: <span id="edgeCount">--</span> <span id="searchHits"></span></div>
<script src="https://unpkg.com/@antv/g6/dist/g6.min.js"></script>
<script>
// ====== åŸè³‡æ–™è½‰æ›ç‚º G6 mind map çµæ§‹ ======
const RAW = {
  title: 'Slot Game AI Agent Pipeline',
  children: [
    { label:'AI ä»£ç†', icon:'ğŸ§©', children:[
      { label:'ConceptArtAgent', meta:'ä¸»è¦–è¦º / é¢¨æ ¼æ¢ç´¢ â†’ concept_batch' },
      { label:'DesignParserAgent', meta:'è§£æä¼åŠƒ â†’ game_structure.json' },
      { label:'MathModelAgent', meta:'RTP æ¨¡æ“¬ â†’ math_model.json' },
      { label:'PSDAnalyzerAgent', meta:'PSD åœ–å±¤ â†’ art_spec.json' },
      { label:'AssetGenAgent', meta:'éœæ…‹ç´ æç”Ÿæˆ â†’ symbols/*.png' },
      { label:'PromptOptimizerAgent', meta:'å¤±æ•—æ¨£æœ¬å­¸ç¿’ â†’ æœ€ä½³åŒ– Prompt' },
      { label:'VFXSpecAgent', meta:'å‹•æ•ˆè¦æ ¼ â†’ vfx_spec.json' },
      { label:'VFXGenAgent', meta:'å‹•æ•ˆè¼¸å‡º â†’ frames / spine / Lottie' },
      { label:'EngineIntegrationAgent', meta:'æ•´åˆ â†’ manifest / slot_config.json' },
      { label:'SimulationAgent', meta:'è‡ªå‹•æ¸¬è©¦ â†’ validation_report' },
      { label:'AuditAgent', meta:'è¿½æº¯ â†’ decision_log.json' }
    ]},
    { label:'12 éšæ®µæµç¨‹', icon:'ğŸ—‚ï¸', children:[ '1 Concept Art ç”Ÿæˆ','2 è¦–è¦ºå¯©æ ¸','3 ä¼åŠƒè§£æ','4 æ•¸å­¸æ¨¡å‹æ¨¡æ“¬','5 PSD è¦æ ¼ JSON','6 éœæ…‹ç”Ÿæˆ + Prompt','7 éœæ…‹å¯©æ ¸','8 å‹•æ•ˆè¦æ ¼','9 å‹•æ•ˆç”Ÿæˆ','10 å‹•æ•ˆå¯©æ ¸','11 æ•´åˆå¼•æ“','12 æ¸¬è©¦é©—è­‰' ].map(x=>({label:x})) },
    { label:'å¥‘ç´„æª¢æŸ¥é»', icon:'ğŸ§ª', children:[ 'é¢¨æ ¼åˆ†æ•£åº¦','æ¬„ä½å®Œæ•´æ€§','RTP åå·®','å‘½ååˆè¦','è‰²å','ç‰¹æ•ˆæ™‚é–“é‡ç–Š','ç¼ºè³‡ç”¢æƒæ' ].map(x=>({label:x})) },
    { label:'KPI æŒ‡æ¨™', icon:'ğŸ“Š', children:[ 'é¢¨æ ¼ä¸€è‡´ â‰¥0.85','RTP æ”¶æ–‚ â‰¤5','éœæ…‹äººå·¥å¯©æ ¸ <30%','å‹•æ•ˆç•°å¸¸å¹€ <1%','Prompt è¿­ä»£ â‰¤3','æ•´åˆéŒ¯èª¤ â‰¤1','RTP åå·® â‰¤0.5%','é€±æœŸç¸®çŸ­ â‰¥50%' ].map(x=>({label:x})) },
    { label:'é¢¨éšªèˆ‡ç·©è§£', icon:'âš ï¸', children:[
      {label:'é¢¨æ ¼æ¼‚ç§»', meta:'åµŒå…¥æ¯”å° + è‰²ç¥¨é–å®š'},
      {label:'Prompt å†—é•·', meta:'Token æ¬Šé‡åˆ†æ'},
      {label:'PSD æ··äº‚', meta:'å‘½åæ­£è¦åŒ–'},
      {label:'RTP åå·®å¤§', meta:'å†æ¨¡æ“¬è¿­ä»£'},
      {label:'å‹•æ•ˆé–ƒçˆ', meta:'FrameDiff æª¢æ¸¬'},
      {label:'è³‡ç”¢ç¼ºæ¼', meta:'hash æƒæ'},
      {label:'è¿½æº¯å›°é›£', meta:'decision_log.json'}
    ]},
    { label:'Prompt æ¨¡æ¿', icon:'ğŸ’¬', children:[
      {label:'éœæ…‹ç¬¦è™Ÿ Prompt', meta:'slot symbol of [å…ƒç´ ] ...'},
      {label:'å‹•æ…‹ç‰¹æ•ˆæ™‚é–“è»¸', meta:'charge/burst/fade JSON'},
      {label:'æ•¸å­¸æ¨¡å‹ç”Ÿæˆ', meta:'RTP simulate + adjust'}
    ]},
    { label:'å°å…¥å„ªå…ˆé †åº', icon:'ğŸ§­', children:[ '1 æ•¸å­¸/ä¼åŠƒè§£æ','2 PSD è¦æ ¼åŒ–','3 éœæ…‹ç”Ÿæˆ + å¯©æ ¸','4 å‹•æ…‹ç‰¹æ•ˆ','5 æ•´åˆèˆ‡é©—è­‰' ].map(x=>({label:x})) },
    { label:'Audit ç´€éŒ„', icon:'ğŸ“‘', children:[ {label:'decision_log.json ç¯„ä¾‹', meta:'timestamp/action/èª¿æ•´/æ ¸å‡†'} ]},
    { label:'æœªä¾†å¢å¼·', icon:'ğŸ’¡', children:[ 'å·®ç•°è¦–è¦ºåŒ– Diff UI','å‹•æ•ˆåƒæ•¸ RL å„ªåŒ–','ç©å®¶è¡Œç‚ºå›é¥‹è¿­ä»£','Prompt Ensembling' ].map(x=>({label:x})) }
  ]
};

function toG6(root){
  const traverse = (node, path=[]) => {
    const id = [...path,node.label||node.title].join('>');
    const name = (node.icon? node.icon+' ':'') + (node.label||node.title);
    const item = { id, label:name, raw:node, children:[] };
    if(node.meta) item.meta = node.meta;
    if(node.children) item.children = node.children.map(ch=> traverse(ch, [...path,node.label||node.title]));
    return item;
  };
  return traverse({label:root.title, children:root.children});
}

const treeData = toG6(RAW);

// ====== G6 è¨­å®š ======
const graph = new G6.TreeGraph({
  container: 'mount',
  width: window.innerWidth,
  height: document.getElementById('mount').clientHeight,
  pixelRatio: window.devicePixelRatio || 1,
  fitView: true,
  modes: { default: ['drag-canvas','zoom-canvas','collapse-expand','drag-node'] },
  animate: true,
  layout: {
    type: 'compactBox',
    direction: 'LR', // å·¦â†’å³ï¼Œå¯åˆ‡æ› TB / LR / RL
    getId: d => d.id,
    getHeight: () => 28,
    getWidth: (d) => Math.min(260, (d.label||'').length * 9 + 40),
    getVGap: () => 12,
    getHGap: () => 40
  }
});

// é¡è‰²ç­–ç•¥ï¼šæ ¹ â†’ ä¸»å±¤èª¿è‰²ç›¤ â†’ ä¸‹å±¤æ¼¸æ·¡
const PALETTE = ['#4f8bff','#ff6f4f','#6dd96b','#ffcb3c','#c55bff','#38d5e7','#ff3fa4','#9cc94f','#ff8bd2','#52b3ff'];
function colorFor(node){
  if(!node.depth || node.depth===0) return '#4f8bff';
  if(node.depth===1){
    const i = node.id.split('>').slice(1,2).join('').length % PALETTE.length;
    return PALETTE[i];
  }
  // æ‰¾ç¬¬ä¸€å±¤ ancestor id
  const parts = node.id.split('>');
  const top = parts[1] || ''; const idx = top.length % PALETTE.length;
  const base = PALETTE[idx];
  // ç°¡æ˜“è®Šäº®
  return base;
}

graph.node(node => {
  const fill = '#1d2731';
  const stroke = colorFor(node);
  const meta = node.raw && node.raw.meta ? node.raw.meta : '';
  return {
    label: node.label + (meta? '\n'+meta : ''),
    labelCfg:{
      style:{
        fontSize:12, lineHeight:15, fill:'#dbe5ec', fontFamily:'Inter, system-ui',
        textAlign:'left'
      }
    },
    style:{
      fill, stroke, radius:10, lineWidth:2, cursor:'pointer', shadowColor:'#000', shadowBlur:6
    }
  };
});

graph.on('node:dblclick', e=>{
  const item = e.item; graph.setItemState(item,'collapsed', !item.getModel().collapsed); graph.layout(); updateStats();
});

graph.data(treeData);
graph.render();
updateStats();

// ====== åŠŸèƒ½å·¥å…·åˆ— ======
function traverseAll(fn){
  graph.getNodes().forEach(n=> fn(graph.getNodeData(n))); // G6 v4 æ¨™æº–å¯èƒ½ä¸åŒç‰ˆæœ¬ APIï¼›ä¿ç•™å…¼å®¹
}

function expandAll(){
  graph.getNodes().forEach(n=>{ const m = n.getModel(); if(m.children && m.children.length) graph.updateItem(n,{ collapsed:false }); });
  graph.layout(); updateStats();
}
function collapseAll(){
  graph.getNodes().forEach(n=>{ const m = n.getModel(); if(m.children && m.children.length) graph.updateItem(n,{ collapsed:true }); });
  graph.layout(); updateStats();
}
function updateStats(){
  document.getElementById('nodeCount').textContent = graph.getNodes().length;
  document.getElementById('edgeCount').textContent = graph.getEdges().length;
}

// æœå°‹é«˜äº®
function clearHighlight(){ graph.getNodes().forEach(n=> graph.clearItemStates(n)); }
function searchNodes(q){
  clearHighlight(); if(!q){ document.getElementById('searchHits').textContent=''; return; }
  const lower = q.toLowerCase(); let hits=0;
  graph.getNodes().forEach(n=>{
    const m = n.getModel();
    if((m.label||'').toLowerCase().includes(lower)){
      graph.setItemState(n,'highlight',true); hits++;
      // å±•é–‹å…¶ç¥–å…ˆ
      let parent = n.getModel().parent;
      while(parent){ parent.collapsed=false; parent = parent.parent; }
    }
  });
  graph.layout(); updateStats();
  document.getElementById('searchHits').textContent = 'æœå°‹å‘½ä¸­: '+hits;
}

// è‡ªè¨‚ç‹€æ…‹æ¨£å¼
graph.setItemState('node','highlight',{ style:{ stroke:'#ffcf33', lineWidth:3 } });

// Export PNG
function exportPNG(){
  const dataURL = graph.toDataURL('image/png');
  const a=document.createElement('a'); a.href=dataURL; a.download='mindmap_g6.png'; a.click();
}

// Resize handler
window.addEventListener('resize',()=>{ graph.changeSize(window.innerWidth, document.getElementById('mount').clientHeight); });

// Toolbar events
 document.getElementById('expandAll').onclick=expandAll;
 document.getElementById('collapseAll').onclick=collapseAll;
 document.getElementById('fitView').onclick=()=> graph.fitView(20);
 document.getElementById('resetLayout').onclick=()=> graph.layout();
 document.getElementById('exportPNG').onclick=exportPNG;
 document.getElementById('search').addEventListener('input', e=> searchNodes(e.target.value.trim()));

</script>
</body>
</html>